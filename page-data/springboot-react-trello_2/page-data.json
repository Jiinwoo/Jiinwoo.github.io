{"componentChunkName":"component---src-templates-post-tsx","path":"/springboot-react-trello_2/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>Spring은 배운지 얼마안됐고 security는 더더욱 안됐다.</p>\n<p>정확하지 않을 수 있습니다.</p>\n</blockquote>\n<h2 id=\"springboot-프로젝트-생성\" style=\"position:relative;\"><a href=\"#springboot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-label=\"springboot 프로젝트 생성 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"#springboot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-label=\"springboot 프로젝트 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>springboot 프로젝트 생성</h2>\n<p>나는 Intellij 안의 spring initializer를 사용했지만 직접 스프링이니셜라이저 사이트에\n들어가서 다운받는거랑 같다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7a8fdc2f383bd29ac0bbdbca70e8144c/5148a/create-project1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA30lEQVQoz6WSzW6DMBCE/VwY/6y9xjZplSjX3KL2DfL+k4UQipBKQ3oYgdnV59kdlM8fIO6grYcLDBcTLAVYH2Acod2hoV8RZ1DK0HIIqUMsB3guMALcBZv6VSwdAkfoth2BXi6wUUQ8NpnJ6ZaewEEqnb/webkhnr6lEH4gfhp7h9NhbSrWE1J/Rktl/PCuZiDLyMSMxphdO1s7m4G1ZqT8CGFZeBvIpZcw8gryD2Do6gx81aG2G6EsIa8AH7VFILJ7bRwaeW/kqX5L6y+H1hNc6mGPV/lLjsj1gCTruwMBNH+xyMgOywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create project1\"\n        title=\"create project1\"\n        src=\"/static/7a8fdc2f383bd29ac0bbdbca70e8144c/fcda8/create-project1.png\"\n        srcset=\"/static/7a8fdc2f383bd29ac0bbdbca70e8144c/12f09/create-project1.png 148w,\n/static/7a8fdc2f383bd29ac0bbdbca70e8144c/e4a3f/create-project1.png 295w,\n/static/7a8fdc2f383bd29ac0bbdbca70e8144c/fcda8/create-project1.png 590w,\n/static/7a8fdc2f383bd29ac0bbdbca70e8144c/efc66/create-project1.png 885w,\n/static/7a8fdc2f383bd29ac0bbdbca70e8144c/c83ae/create-project1.png 1180w,\n/static/7a8fdc2f383bd29ac0bbdbca70e8144c/5148a/create-project1.png 1228w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54eee1bb047369c81dd89d9f61bc646e/5148a/create-project2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA2klEQVQoz5WSaxLCIAyEey4t5dWElmqd8Qbe/xBrqK1THKr4Y4chgS+bQOM4gscIRwHaepw7g1bbQ5XyWyytjXYetmdwnOA4CJgXeCaJW4mXgGmfAY0nAdLqkt/AVMT4fieqc7gd1o6gjMuSJR25zB3SAE0TOpdcmAWsjF3Xl1pTOcPUmucBcb4hTBfQMKIPH5KYD0NtyyTAgHidV2BcCiRAJjlTBdyCnXyZfYslVQGPhv/Po+zBza+P/M3NSWmclRJpnNZ986tqSelymilf7lDzAxTlQcdpmf8TgKaBMykC5I0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create project2\"\n        title=\"create project2\"\n        src=\"/static/54eee1bb047369c81dd89d9f61bc646e/fcda8/create-project2.png\"\n        srcset=\"/static/54eee1bb047369c81dd89d9f61bc646e/12f09/create-project2.png 148w,\n/static/54eee1bb047369c81dd89d9f61bc646e/e4a3f/create-project2.png 295w,\n/static/54eee1bb047369c81dd89d9f61bc646e/fcda8/create-project2.png 590w,\n/static/54eee1bb047369c81dd89d9f61bc646e/efc66/create-project2.png 885w,\n/static/54eee1bb047369c81dd89d9f61bc646e/c83ae/create-project2.png 1180w,\n/static/54eee1bb047369c81dd89d9f61bc646e/5148a/create-project2.png 1228w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>지금 프로젝트에서는 이정도만 설치하자.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 381px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a74a451ca1809c5f5dca343e43f8ac19/2add2/create-project3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 168.24324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAYAAABfqvm9AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACGUlEQVRIx+1W246bMBDlsxJ8wdwNmEuibpas+tJKrfoNVfvtpzNOYRVatJDX3YeRGBgfzrHHMxOYrEBZt8htjaJ2KKrGW0mWFhYyMmTxZguSvETb96ibxls3DN5vhzOqpoXUBmKHBWGUQRRnCHtBmA0I84H8Ew6hxFHqHWCRt0CaDJE9IeuuyNsLTNlDF/1uqdIkN4ZCEQspUFqLxjmYJEEolQ/ayo5j1QxoUmJEMk2OUOk5wAe/weoudtpDSUCR+wyd1XQAEQUkd8FyI+j0HDArqTVc16PpBn+6CaVSqKJdgIqU3iTzC5ad5FBxuvr3NbCl7EDGxU1y9wUitjiK13R5C3Qpd2ao4szLrdselm5NQ/JNmm/ax39PmfdKKb9vKd0aBuLbo+N0F+B8KJPko4xwEMrLPQg9H8oWyXdpI3QMnbfIysoz5ILAFhPjhxh6yVHk968hq9uOqo/z4I/tISUzO1yyKtdSpTl5tix9a+osAM3qoofy8H8vt+Tg2sGsMtx7l1cZ7qqBH4AfgO8S8NVuPXlpy2litac8wmyN7QzIJZ9rIBs/c53kns1twY8rfhgyc8zki7/rpjXBxM5RYX0arzhfRqrcDmE1Qr38QvP1N8T40/sVjXv8/dPzFZZGPW4VjgaDp/EF3YkGBPJnwJwqtutvk0NBg1OY0wQ2fId9/gHZf4MgPytK/2O2jBZzh+R1vMY2zvt/ANLNpCqygeCAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create project3\"\n        title=\"create project3\"\n        src=\"/static/a74a451ca1809c5f5dca343e43f8ac19/2add2/create-project3.png\"\n        srcset=\"/static/a74a451ca1809c5f5dca343e43f8ac19/12f09/create-project3.png 148w,\n/static/a74a451ca1809c5f5dca343e43f8ac19/e4a3f/create-project3.png 295w,\n/static/a74a451ca1809c5f5dca343e43f8ac19/2add2/create-project3.png 381w\"\n        sizes=\"(max-width: 381px) 100vw, 381px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>그리고 api, config 패키지를 다음과 같이 생성하자\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 335px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8f5d0b76e218fb4cc60974b6599e546/c0051/folder1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.1081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADD0lEQVRIx51V2U7bQBT1P9A+VH3pC0uBComtJPFuj7exx0uclYBo1PL/f3B67ySmgIKS9OFo7PHcM+euNsIoQXP/BDlfYjRfQMQJHF8gjNMX+CLWCOhZJJneC8iOEa732KZvuTDi0MJw2uL3OMOyCtCOKoyHBfLMR5EFtHagdxkSgpdv3XdeZeojS4gw8B1IGeOpSbEY5pgQeVVKiNCBEO5bhGtseI4Ew4NxZ5Ihya6mj8hHc8hCwQ0EeiS/b3t7ghT2rRVhM56hGk2Rl7UmHdBH0/H2hiYMohjD2QItwfN89Eh1R7gvscEGLDWiTFXjOUrKeFWWOnt82XuDbRcYL0rIOJYFosUfRLNfyDKp95m0wy6qjdeHLIKbSESTR9TtmGov0gnyw0jXnOMHuyvUaujZdj0k5H49XUDVLXJVoahqQqNjzcXbCdgETTh45Qavd6YNj1SNH8j1ooRF+71XLq/ObSY1THaVDnQY2JR1clXVQ7TzByRpBkXqbJ19mxTaejWdt3YdjK8XFg7ObHw6/4cDXs9MfLkU+CaX+O4onJg5TqwVTu0Cn3+sz72DcXpr4+jGwTHh6NrB4ZWNw0sThz8DnKsprtMReqKEmdToC4WLgcCVk+Dk1tXnj2/ewrBJukOJ4NXzfT1t4oQmDCWmWT6jppqUeaEhKCkmuWxSWNhmE4y+DiYH2kec5Tp28/sJirKiWsx1bXINruLnrBO4LcsE7ueipV5+fIZSSl/QWxf05k5xP65Dvj0pKuTNGKoZoRqOkJC6jqy7dPdeXhMqIiyokCVNnIIQUjw39fNWQlYoywZqONad0Sn0QvGf04YI47xE2U60srJu4FEPm/bHsdqqMCOXecgyYV5WunfFByNsK+GAastRLdLZEwqa1kye0Pjii/YdtHpi9/omRFEjbSZUwIriWCKRinq41kNiH1KDZ11YSGSUCKXdrfUw4MRwLG3X30upwdMkn86Q0B8vJ3d59sXkruTyodG1+pknsIh4J4Xcv34zRzB5QkyGKfUstyCT8n8mlUonyPXDnQj/An3rvcg10a6/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"folder1\"\n        title=\"folder1\"\n        src=\"/static/e8f5d0b76e218fb4cc60974b6599e546/c0051/folder1.png\"\n        srcset=\"/static/e8f5d0b76e218fb4cc60974b6599e546/12f09/folder1.png 148w,\n/static/e8f5d0b76e218fb4cc60974b6599e546/e4a3f/folder1.png 295w,\n/static/e8f5d0b76e218fb4cc60974b6599e546/c0051/folder1.png 335w\"\n        sizes=\"(max-width: 335px) 100vw, 335px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">// SecurityConfig.class\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n}</code>\n        </deckgo-highlight-code>\n<p>그리고 어떤 요청을 해보면 다음과 같이 401에러를 내려준다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a20b97e823bafceb604dde4448a2d39/66caf/api-call1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABk0lEQVQoz4VRS5bTMBD0OZJJMs5g2dbHkizLku3ECTOzYgEnYMMFeKy4DcfhWkVLJI/ZAIt6avWnuru6WNcL1nXFPM/w3mNZFhitwTmHECIj2W//Iv2FRPXlBx6+/QT79B3XU8Tl+ozi5XrBeZkzUZwifPCIMUKZDm5wML2FHwaMYUTf9xkuvw785TPYh68w60dcxh7v1zOK1fc4EYlSClJK6syzLaSApknlzX+PJyR/T41kfYSsDlCcQbYNgh9QsLalBIOa1ajrP2CM5WnSism+x1nFYIzBNE0kgyBfi4Ze2dSItFExjz4XKt3B2j6vqo2Gcy5PkwhVRz5L01qV48YadPRPeUorBKMwKI6JZClezzNOpyUfZCLtxhhy9zHQS4eK44jgLElA5IpWvuG3rbKtCZHWjVRbsKa5JXTgSTuSQJGOnDRJiZrshlUoyxLH4/GfSEMVKXG320OGFdYH2LaCqJ7w9HjAu/KAqnzEw25HOX/Hfr/HZrPJh8uEJbE32mXxDxRMDRLJHangf9hut/lYvwCLohJxT4SiYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"api call1\"\n        title=\"api call1\"\n        src=\"/static/0a20b97e823bafceb604dde4448a2d39/fcda8/api-call1.png\"\n        srcset=\"/static/0a20b97e823bafceb604dde4448a2d39/12f09/api-call1.png 148w,\n/static/0a20b97e823bafceb604dde4448a2d39/e4a3f/api-call1.png 295w,\n/static/0a20b97e823bafceb604dde4448a2d39/fcda8/api-call1.png 590w,\n/static/0a20b97e823bafceb604dde4448a2d39/66caf/api-call1.png 853w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n기본적으로 모든 요청에 인증이 필요하기 때문이다. 앞으로 method를 오버라이드해서\n설정들을 변경해볼 것이다.</p>\n<h3 id=\"인증authentication\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9Dauthentication\" aria-label=\"인증authentication permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"#%EC%9D%B8%EC%A6%9Dauthentication\" aria-label=\"인증authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증(Authentication)</h3>\n<p>우선 로그인 과정부터 생각해 보자.</p>\n<deckgo-highlight-code language=\"json\"  terminal=\"carbon\" >\n          <code slot=\"code\">{\n &quot;email&quot; : &quot;any@abc.com&quot;,\n &quot;password&quot; : &quot;1234&quot;\n}</code>\n        </deckgo-highlight-code>\n<ol>\n<li>프론트에서는 /api/auth/login 으로 위와 같은 json을 보낸다.  </li>\n<li>Security filter chain에서 \"특정 filter\"에서 해당 정보를 AuthenticationToken으로 만들어서\nAuthenticationManager한테 전달 한 후 인증해달라고 한다.</li>\n<li>AuthenticationManager는 현재 등록되어있는 Provider들한테 인증요청한다.  </li>\n<li>Provider는 UserDetailService한테 DB에 존재하는지 존재하면 UserDetails를 반환해달라고 한다.</li>\n<li></li>\n</ol>\n<p> 여기서 \"특정 filter\"로는 AbstractAuthenticationProcessingFilter를 상속받은 JwtAuthenticationFilter를 만들었다. 그 뒤\nattemptAuthentication메소드를 재정의 해주면 된다.</p>\n<p>이 필터의 역활은 자기가 가지고있는 AuthenticationManager한테 (인증되지 않은)Authentication을 넘기면서 인증 해달라고 요청\n한 뒤 결과로 (인증된) Authentication을 받아서 successfulAuthentication를 호출하고 다음필터로 넘어간다. 그전에 에러가\n발생하면 unsuccessfulAuthentication를 호출한다.</p>\n<p>우선 사용자의 로그인 정보를 담을 DTO를 생성하자</p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">@Getter\n@NoArgsConstructor\npublic class LoginRequestDTO {\n    private String email;\n    private String password;\n}</code>\n        </deckgo-highlight-code>\n<p>다음으로 Authentication 인터페이스의 구현체인 AbstractAuthenticationToken을 상속받은 JwtAuthenticationToken을 만들자</p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">public class JwtAuthenticationToken extends AbstractAuthenticationToken {\n    private final Object principal;\n    private final String credentials;\n\n    public JwtAuthenticationToken(Collection&lt;? extends GrantedAuthority&gt; authorities,Object principal, String credentials) {\n        super(authorities);\n        setAuthenticated(true);\n        this.principal = principal;\n        this.credentials = credentials;\n    }\n\n    public JwtAuthenticationToken(Object principal, String credentials) {\n        super(null);\n        setAuthenticated(false);\n        this.principal = principal;\n        this.credentials = credentials;\n    }\n\n    @Override\n    public Object getCredentials() {\n        return null;\n    }\n\n    @Override\n    public Object getPrincipal() {\n        return null;\n    }\n}</code>\n        </deckgo-highlight-code>\n<p>그리고 attemptAuthentication 추상 메소드를 override해서 구현해주자.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 589px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bff064fcd41f95f89cfb4739226d8a6/b1665/implement.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAxklEQVQY023I206DQBRGYV7GtIgVQk1UCu2IMBxmbBC1jY2nm8pr2MTExPadlwN4YYIXX/a/l5XmiqzUyEKTZgW5WpLmJeHiakBcSzx/im3bOM6J4QxYcZIg4phESuZCMIuiThCGA7Nojuu5jEdHHNujf4yx1O2GsnpE1RuymxVSPxgr8mVrbdq66+1uTS8EE+8c1w849S//CJi4Z1hVc6B+//61567Zd7du+t26N6pt3/XrJ+XzDvXSK5525v9Av32x0Ft+AGPBkiPA3R6wAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"implement\"\n        title=\"implement\"\n        src=\"/static/6bff064fcd41f95f89cfb4739226d8a6/b1665/implement.png\"\n        srcset=\"/static/6bff064fcd41f95f89cfb4739226d8a6/12f09/implement.png 148w,\n/static/6bff064fcd41f95f89cfb4739226d8a6/e4a3f/implement.png 295w,\n/static/6bff064fcd41f95f89cfb4739226d8a6/b1665/implement.png 589w\"\n        sizes=\"(max-width: 589px) 100vw, 589px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">public class JwtAuthenticationFilter extends AbstractAuthenticationProcessingFilter {\n    private static final String ERROR_MESSAGE = &quot;Something went wrong while parsing /login request body&quot;;\n    ObjectMapper objectMapper;\n\n    protected JwtAuthenticationFilter(ObjectMapper objectMapper) {\n        super(new AntPathRequestMatcher(&quot;/api/auth/login&quot;, &quot;POST&quot;));\n        this.objectMapper = objectMapper;\n    }\n\n    @Override\n    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException, IOException, ServletException {\n        if (!request.getMethod().equals(&quot;POST&quot;)) {\n            throw new AuthenticationServiceException(\n                    &quot;Authentication method not supported: &quot; + request.getMethod());\n        }\n        try {\n            LoginRequestDTO credentials = objectMapper.readValue(request.getInputStream(),LoginRequestDTO.class);\n            JwtAuthenticationToken authenticationToken = new JwtAuthenticationToken(\n                    credentials.getEmail(),\n                    credentials.getPassword()\n            );\n            Authentication auth = this.getAuthenticationManager().authenticate(authenticationToken);\n            return auth;\n        }catch (IOException e){\n            throw new InternalAuthenticationServiceException(ERROR_MESSAGE, e);\n        }\n    }\n}</code>\n        </deckgo-highlight-code>\n<p>여기서 눈여겨 보아야 할 점은 JwtAuthenticationToken을 만들어서 AuthenticationManager한테 authenticate해달라고 요청 하는\n부분이다.\nSecurityConfig에서 AuthenticationManager를 등록해야한다. 그리고 기타 설정들을 추가하자</p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">@RequiredArgsConstructor\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n    private final CustomUserDetailsService customUserDetailsService;\n    private final ObjectMapper objectMapper;\n    private final SecurityHandler securityHandler;\n    private final CustomAuthenticationEntryPoint customAuthenticationEntryPoint;\n    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception {\n        auth.authenticationProvider(authenticationProvider());\n    }\n\n    @Override\n    public void configure(WebSecurity web) throws Exception {\n        web.ignoring()\n                .antMatchers(&quot;/resources/**&quot;)\n                .antMatchers(&quot;/css/**&quot;)\n                .antMatchers(&quot;/vendor/**&quot;)\n                .antMatchers(&quot;/js/**&quot;)\n                .antMatchers(&quot;/favicon*/**&quot;)\n                .antMatchers(&quot;/img/**&quot;)\n        ;\n    }\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.headers().frameOptions().disable();\n        http\n                // remove csrf and state in session because in jwt we do not need them\n                .csrf().disable()\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                // add jwt filters (1. authentication, 2. authorization)\n                .addFilter(jwtAuthenticationFilter())\n                .addFilter(jwtAuthorizationFilter())\n                .authorizeRequests()\n                // configure access rules\n                .antMatchers(HttpMethod.POST, &quot;/api/auth/**&quot;).permitAll()\n                .antMatchers(&quot;/h2-console/**&quot;).permitAll()\n                .antMatchers(&quot;/api/public/management/*&quot;).hasRole(&quot;MANAGER&quot;)\n                .antMatchers(&quot;/api/public/admin/*&quot;).hasRole(&quot;ADMIN&quot;)\n                .anyRequest().authenticated()\n                .and()\n                .exceptionHandling()\n                .authenticationEntryPoint(customAuthenticationEntryPoint);\n    }\n\n    @Bean\n    public AuthenticationProvider authenticationProvider() {\n        DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider();\n        daoAuthenticationProvider.setPasswordEncoder(passwordEncoder());\n        daoAuthenticationProvider.setUserDetailsService(customUserDetailsService);\n        return daoAuthenticationProvider;\n    }\n\n    @Bean\n    public JwtAuthenticationFilter jwtAuthenticationFilter() throws Exception {\n        JwtAuthenticationFilter filter = new JwtAuthenticationFilter(objectMapper);\n        filter.setAuthenticationManager(authenticationManager());\n        filter.setAuthenticationSuccessHandler(securityHandler);\n        filter.setAuthenticationFailureHandler(securityHandler);\n        filter.afterPropertiesSet();\n        filter.setFilterProcessesUrl(&quot;/api/auth/signin&quot;);\n        return filter;\n    }\n    @Bean\n    public JwtAuthorizationFilter jwtAuthorizationFilter () throws Exception {\n        JwtAuthorizationFilter filter = new JwtAuthorizationFilter(authenticationManager(),customUserDetailsService);\n        return filter;\n    }\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n}</code>\n        </deckgo-highlight-code>\n<blockquote>\n<p>6/6 UsernamePasswordAuthenticationFilter 대신에 이 필터의 부모클래스인 AbstractAuthenticationProcessingFilter를 상속받아\n새로만들었는데(JwtAuthenticationFilter) 위와 같이 해주면 오류가난다 ㅠㅠ 왜냐면 기본으로 filterChain에 등록된 UsernamePasswordAuthenticationFilter\n를 갈아끼우는게 안되기 때문!\n대신 .addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class)요걸로 바꿔주면\n다시 작동한다. ㅠㅠ </p>\n</blockquote>\n<p>여기서 아직 구현하지 않은 것들이 있는데 만들어야 할 것들에는 </p>\n<ol>\n<li>Provider 구현체 DaoAuthenticationProvider</li>\n<li>AuthenticationEntryPoint 구현체 CustomAuthenticationEntryPoint</li>\n<li>header인증을 위한 BasicAuthenticationFilter 구현체 JwtAuthorizationFilter</li>\n<li>User Entity 및 UserPrincipal </li>\n<li>UserDetailsService 구현체 CustomUserDetailsService</li>\n<li>ErrorResponseDTO</li>\n</ol>\n<p>는 다음포스트에서 만들자</p>","excerpt":"Spring은 배운지 얼마안됐고 security는 더더욱 안됐다. 정확하지 않을 수 있습니다. springboot 프로젝트 생성 나는 Intellij 안의 spring initializer…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/springboot-react-trello_2/#springboot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\">springboot 프로젝트 생성</a></p>\n<ul>\n<li><a href=\"/springboot-react-trello_2/#%EC%9D%B8%EC%A6%9Dauthentication\">인증(Authentication)</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/springboot-react-trello_2/"},"frontmatter":{"title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 2 )","date":"May 23, 2020","tags":["springboot","react"],"keywords":["trello","springboot","react"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/springboot-react-trello_2/","series":[{"slug":"/springboot-react-trello_1/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 1 )","num":1},{"slug":"/springboot-react-trello_2/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 2 )","num":2},{"slug":"/springboot-react-trello_3/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 3 )","num":3},{"slug":"/springboot-react-trello_4/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 4 )","num":4}],"lastmod":"0001-01-01"}},"staticQueryHashes":["3649515864","63159454"]}