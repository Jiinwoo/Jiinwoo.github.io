{"componentChunkName":"component---src-templates-post-tsx","path":"/spring-in-action-5-3ch-bug/","result":{"data":{"markdownRemark":{"html":"<p>최근에 스프링 인 액션 5 책을 보고있는데 문제점이 한두개가 아니다. 책 소개글에 이전 버전에 나타난 여러 문제들을 해결했다고\n나와있는데 전혀 그런 것 같지 않다. 가뜩이나 스프링 잘못해서 사서 공부하는데 해결하는데 시간이 더 많이 든다.. ㅠㅠ</p>\n<p>또 예제 리파지토리는 실행해보고 올린것인지 의문이 든다. </p>\n<p>우선 첫 번째로 헤맸던 것은</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/design\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@SessionAttributes</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DesignTacoController</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">IngredientRepository</span> ingredientRepo<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">TacoRepository</span> tacoRepo<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">DesignTacoController</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token class-name\">IngredientRepository</span> ingredientRepo<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TacoRepository</span> tacoRepo<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ingredientRepo <span class=\"token operator\">=</span> ingredientRepo<span class=\"token punctuation\">;</span>\n\t  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tacoRepo <span class=\"token operator\">=</span> tacoRepo<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@GetMapping</span>\n\t  <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">showDesignForm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    \n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Ingredient</span><span class=\"token punctuation\">></span></span> ingredients <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    ingredientRepo<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">-></span> ingredients<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t    <span class=\"token class-name\">Type</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> types <span class=\"token operator\">=</span> <span class=\"token class-name\">Ingredient</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Type</span><span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Type</span> type <span class=\"token operator\">:</span> types<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t      model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t          <span class=\"token function\">filterByType</span><span class=\"token punctuation\">(</span>ingredients<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\n\t    model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"taco\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Taco</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t    <span class=\"token keyword\">return</span> <span class=\"token string\">\"design\"</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\t\n\t  <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Ingredient</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filterByType</span><span class=\"token punctuation\">(</span>\n\t      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Ingredient</span><span class=\"token punctuation\">></span></span> ingredients<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Type</span> type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">return</span> ingredients\n\t              <span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t              <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-></span> x<span class=\"token punctuation\">.</span><span class=\"token function\">getType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t              <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token annotation punctuation\">@ModelAttribute</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span>\n\t  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Order</span> <span class=\"token function\">order</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token annotation punctuation\">@ModelAttribute</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"taco\"</span><span class=\"token punctuation\">)</span>\n\t  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Taco</span> <span class=\"token function\">taco</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Taco</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token annotation punctuation\">@PostMapping</span>\n\t  <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">processDesign</span><span class=\"token punctuation\">(</span>\n\t\t\t  <span class=\"token annotation punctuation\">@Valid</span> <span class=\"token class-name\">Taco</span> design<span class=\"token punctuation\">,</span> \n\t\t\t  <span class=\"token class-name\">Errors</span> errors<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@ModelAttribute</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errors<span class=\"token punctuation\">.</span><span class=\"token function\">hasErrors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t <span class=\"token keyword\">return</span> <span class=\"token string\">\"design\"</span><span class=\"token punctuation\">;</span>\n\t\t  <span class=\"token punctuation\">}</span>\n\n\t\t  <span class=\"token class-name\">Taco</span> saved <span class=\"token operator\">=</span> tacoRepo<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>design<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t  order<span class=\"token punctuation\">.</span><span class=\"token function\">addDesign</span><span class=\"token punctuation\">(</span>saved<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t  <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/orders/current\"</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://github.com/Jpub/SpringInAction5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/Jpub/SpringInAction5</a> 원 제작자 측이 아닌 출판사 측에서 만든 리포를 가져왔다. ch3/ch03-jdcb부분이다\n처음에 GET메소드로 thymeleaf페이지를 가져오고 submit form을 하면 재료가 전달되서 POST메소드에서 처리하는 간단한\n컨트롤러이다. </p>\n<p>하지만 POST메소드를 보면 @Valid 를 통해 검증하고 에러가 존재하면 다시 design 페이지를 반환하는데 이 때\n재료 model객체가 사라져 다음과 같이 표시된다.\n<img src=\"https://user-images.githubusercontent.com/23472139/50333580-9e58e480-0527-11e9-801a-c5aa57def341.JPG\">\n우선 이것을 해결하는 방법은 </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@ModelAttribute</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addIngredientToModel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Ingredient</span><span class=\"token punctuation\">></span></span> ingredients <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ingredientRepo<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">-></span> ingredients<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Type</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> types <span class=\"token operator\">=</span> <span class=\"token class-name\">Ingredient</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Type</span><span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Type</span> type <span class=\"token operator\">:</span> types<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token function\">filterByType</span><span class=\"token punctuation\">(</span>ingredients<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token annotation punctuation\">@GetMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">showDesignForm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"taco\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Taco</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"design\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 리팩토링 한다. 메소드에 @ModelAttribute를 붙임으로서 GET메소드에만 model에 적용 되지 않고 해당 컨트롤러\n전체에 적용되도록 한다.</p>\n<p>이제 두번째 문제를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcTacoRepository</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">TacoRepository</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JdbcTemplate</span> jdbc<span class=\"token punctuation\">;</span>\n\n\t  <span class=\"token keyword\">public</span> <span class=\"token class-name\">JdbcTacoRepository</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JdbcTemplate</span> jdbc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jdbc <span class=\"token operator\">=</span> jdbc<span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token annotation punctuation\">@Override</span>\n\t  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Taco</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Taco</span> taco<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">long</span> tacoId <span class=\"token operator\">=</span> <span class=\"token function\">saveTacoInfo</span><span class=\"token punctuation\">(</span>taco<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    taco<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span>tacoId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    \n\t    <span class=\"token comment\">// 스프링 Converter를 우리가 구현한 IngredientByIdConverter의 Convert() 메서드가 이때 자동 실행된다.</span>\n\t    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Ingredient</span> ingredient <span class=\"token operator\">:</span> taco<span class=\"token punctuation\">.</span><span class=\"token function\">getIngredients</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n\t      <span class=\"token function\">saveIngredientToTaco</span><span class=\"token punctuation\">(</span>ingredient<span class=\"token punctuation\">,</span> tacoId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\n\t    <span class=\"token keyword\">return</span> taco<span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> <span class=\"token function\">saveTacoInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Taco</span> taco<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    taco<span class=\"token punctuation\">.</span><span class=\"token function\">setCreatedAt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token class-name\">PreparedStatementCreator</span> psc <span class=\"token operator\">=</span>\n\t        <span class=\"token keyword\">new</span> <span class=\"token class-name\">PreparedStatementCreatorFactory</span><span class=\"token punctuation\">(</span>\n\t            <span class=\"token string\">\"insert into Taco (name, createdAt) values (?, ?)\"</span><span class=\"token punctuation\">,</span>\n\t            <span class=\"token class-name\">Types</span><span class=\"token punctuation\">.</span>VARCHAR<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Types</span><span class=\"token punctuation\">.</span>TIMESTAMP\n\t        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">newPreparedStatementCreator</span><span class=\"token punctuation\">(</span>\n\t           <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>\n\t               taco<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t               <span class=\"token keyword\">new</span> <span class=\"token class-name\">Timestamp</span><span class=\"token punctuation\">(</span>taco<span class=\"token punctuation\">.</span><span class=\"token function\">getCreatedAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t    <span class=\"token class-name\">KeyHolder</span> keyHolder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GeneratedKeyHolder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    jdbc<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>psc<span class=\"token punctuation\">,</span> keyHolder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t    <span class=\"token keyword\">return</span> keyHolder<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">longValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">saveIngredientToTaco</span><span class=\"token punctuation\">(</span>\n\t          <span class=\"token class-name\">Ingredient</span> ingredient<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> tacoId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    jdbc<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>\n\t        <span class=\"token string\">\"insert into Taco_Ingredients (taco, ingredient) \"</span> <span class=\"token operator\">+</span>\n\t        <span class=\"token string\">\"values (?, ?)\"</span><span class=\"token punctuation\">,</span>\n\t        tacoId<span class=\"token punctuation\">,</span> ingredient<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 코드를 보면 IDE 에서 다음과 같이 알려준다\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bccb03b5acd2bebdffae981dda6036b1/c87be/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.13180169286578%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSklEQVQoz42P226bUBBF+ZlWiXHV2IC52CTENpyD4XBNYmwpUf//J1bnEEeK1Jc+LO0ZzWjPHsdbrVj7GyHgYeXxlO04nw3H4zNRFBEnMXEsGt/U9klCKLMwCgnDDVmWsc8Lng85znJxx8OvBevfrugdabplOL/Tv10ZpnfGy4foJ+PlDy/XD96miWEcaboBM06Y/pW27zFti5NuEx7ThCSWa5uAXZqiuwuqm4QredWiLHVLXhoO6sRRleRadKYWKoqymnvH823sgHLv0WmfSmdU3Qv1jarpaQdJML6i60ZMa4qTmfWLQrCH9kUpLy+XrNYej9uAptyh1AHTjZxMNy+qyqDEoLihquYftGBT7guN47ou1vR+4fLj5z1+EHGSVKW8qG+UYj7zVX+bzXPhM6EY+sFGTAKser7P7ilDi2EuF+3S/2LftSn/AouT/GUAQje8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/bccb03b5acd2bebdffae981dda6036b1/799d3/1.png\"\n        srcset=\"/static/bccb03b5acd2bebdffae981dda6036b1/00d96/1.png 148w,\n/static/bccb03b5acd2bebdffae981dda6036b1/0b23c/1.png 295w,\n/static/bccb03b5acd2bebdffae981dda6036b1/799d3/1.png 590w,\n/static/bccb03b5acd2bebdffae981dda6036b1/c87be/1.png 827w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n에엥 난 책에있는대로 했는데 NPE가 발생한다고? 물론 출판사 깃헙 리포에도 똑같다.\n에러를 검색해보니 </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> <span class=\"token function\">saveTacoInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Taco</span> taco<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        taco<span class=\"token punctuation\">.</span><span class=\"token function\">setCreatedAt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">PreparedStatementCreatorFactory</span> pscf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PreparedStatementCreatorFactory</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"Insert into Taco(name, createdAt) values(?,?)\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Types</span><span class=\"token punctuation\">.</span>VARCHAR<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Types</span><span class=\"token punctuation\">.</span>TIMESTAMP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        pscf<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnGeneratedKeys</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">.</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 추가</span>\n        <span class=\"token class-name\">PreparedStatementCreator</span> psc <span class=\"token operator\">=</span> pscf<span class=\"token punctuation\">.</span><span class=\"token function\">newPreparedStatementCreator</span><span class=\"token punctuation\">(</span>\n                <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>taco<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Timestamp</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>taco<span class=\"token punctuation\">.</span><span class=\"token function\">getCreatedAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">KeyHolder</span> keyHolder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GeneratedKeyHolder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        jdbc<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>psc<span class=\"token punctuation\">,</span> keyHolder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> keyHolder<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">longValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 하면 된다.</p>\n<p>아직 책 초반인데 시간을 너무많이 잡아먹는 것 같다. 힘들다.</p>","excerpt":"최근에 스프링 인 액션…","tableOfContents":"","fields":{"slug":"/spring-in-action-5-3ch-bug/"},"frontmatter":{"title":"Spring in Action 5판 3챕터 에러","date":"Jun 10, 2020","tags":["Spring in action","JDBCTemplate"],"keywords":[null],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/spring-in-action-5-3ch-bug/","series":[],"lastmod":"0001-01-01"}}}