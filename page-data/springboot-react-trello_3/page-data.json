{"componentChunkName":"component---src-templates-post-tsx","path":"/springboot-react-trello_3/","result":{"data":{"markdownRemark":{"html":"<p>저번 포스트에서 <del>귀찮아서</del> 작성하지 못했던 security 관련 설정파일들을 작성해보자.</p>\n<ol>\n<li>Provider 구현체 DaoAuthenticationProvider</li>\n<li>UserDetailsService 구현체 CustomUserDetailsService</li>\n<li>User Entity 및 UserPrincipal </li>\n<li>header인증을 위한 BasicAuthenticationFilter 구현체 JwtAuthorizationFilter</li>\n<li>AuthenticationEntryPoint 구현체 CustomAuthenticationEntryPoint</li>\n<li>ErrorResponseDTO</li>\n</ol>\n<h2 id=\"provider\" style=\"position:relative;\"><a href=\"#provider\" aria-label=\"provider permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"#provider\" aria-label=\"provider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provider</h2>\n<p>먼저 나는 Provider를 직접 구현하지 않고 DaoAuthenticationProvider를 사용할 예정이다. 이 클래스를 자세히보면\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/92eaff73f38f1092991bb716e7bdb86b/d7542/dao.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWElEQVQoz4WS6XaEIAyFfZwKWQARl7Hv/1i3AXScmZ6e/vi8MUo2MpTImI04ZUx5Rp4LktmVmKbmSxV7Z2Y45+C9/8XlH3KwYMIgYozj2HDuUgc3uq7/cAUdNCpYCSQEETHsvaoqiLu/UW32L3rbbxVKEKQtIK8z1u0wHli2vbXLyuBwYkkbgW77xNNLQLYK4x6gWSFJnh/H8escgev69TfuGk9t+dgjliMgWsA4R0iwllnO9gVqLalVKpZYP7h8tUsiagxbDljMuZWMfT/wOL6xP7qWsmCxqkuZUI715nHp0nTeiiXVtgWDtwdxv+UryxNv8zkhZ8P/gPwF3bdco9ZBS7K2Jj7V2o3dVrNZ+uAr7Va52y2If1+doVVmh8MaOovNsrJqS1CTkfqO+L5i55r1QO/L3Sqc7OdKtMzJDoUYEUNC4IggZuuEpBnCfWelXlLo0MvKVH4AKxlSOFdPvLYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dao\"\n        title=\"dao\"\n        src=\"/static/92eaff73f38f1092991bb716e7bdb86b/fcda8/dao.png\"\n        srcset=\"/static/92eaff73f38f1092991bb716e7bdb86b/12f09/dao.png 148w,\n/static/92eaff73f38f1092991bb716e7bdb86b/e4a3f/dao.png 295w,\n/static/92eaff73f38f1092991bb716e7bdb86b/fcda8/dao.png 590w,\n/static/92eaff73f38f1092991bb716e7bdb86b/d7542/dao.png 810w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>AbstractUserDetailsAuthenticationProvider를 상속해서 구현한 것을 알 수 있고 이클래스는 다시\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d623a0e4ae3d17bc2bd3530022792783/8c557/super1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz42RWXLEIAxEfZsYjAQIg5fZU5P7H6kj8Ixr/JGqfLySoEFqRMeRIWtAKB4+MUJmxNmDE8HnTYuT35gDZAl7Xs/6kXe95h0HbsWaqITRQyZBmgWxxHaIhVqzlkfa1zWybPubGY+OXgXbhkbRIillpDFDUsLgBgzD/+myVhV9ogsOAw2wg0Xff22YHsaYHWvNYW2MhbH2WPCxRCzq7jIlrCXhumTcnnecnzecvq8at/zyc8f6OGt84Kz56XbCVUdzVkPB6/N5o3POgdXZlEeUMaHkjFwm5FwQRZCnRZkxzYuOYcS0rCi6HlUX1Zno6LAWTGwhZBBdj8CDdtIfpADnSOc4woegxJaHqJ+lOL3c9317sv2gI+1AarW6EUmtq0hEbUTkXpEaNX/z3vvUauyqi3rRM73m4Pd5HCD+0P84o/wCO24YrF54XWsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"super1\"\n        title=\"super1\"\n        src=\"/static/d623a0e4ae3d17bc2bd3530022792783/fcda8/super1.png\"\n        srcset=\"/static/d623a0e4ae3d17bc2bd3530022792783/12f09/super1.png 148w,\n/static/d623a0e4ae3d17bc2bd3530022792783/e4a3f/super1.png 295w,\n/static/d623a0e4ae3d17bc2bd3530022792783/fcda8/super1.png 590w,\n/static/d623a0e4ae3d17bc2bd3530022792783/8c557/super1.png 700w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>AuthenticationProvider 인터페이스를 구현해놓은 것을 알 수 있다.\n이 인터페이스는 메소드로 authenticate메소드를 가지고 있으며\nAuthentication 을 받아 UsernamePasswordAuthenticationToken을 반환하는 역할을 한다.</p>\n<p>하지만 추상클래스이기 때문에 authentication 메소드 안에 사용하는 함수 몇몇개들을 하위에서 implement해서 사용해야한다.\n예를 들어\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a511831ff39e850b7c5d06a6d0c9bd9/33e10/super2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.43243243243244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC1klEQVQ4y41U2XLbMAz0z7SWRPESdVCXHTtNHjqdyf9/zXZBSo5dp9M+rHgKXAALHIKpELuAdYqYlhNO64TLacT5tCBOC9puIHq0/YCOo3MWdV1Da51GpSpCoaryeFC1hvcNQgiIccY0njHOJ6wvV3RDhOOZbwQB3vKuUWhCi9B1sNaiKsubMRkPMimKAuV20LUdDbVoOg/XGvgNMnedhQtEY2AbneFMYvrJkB9h2JCFc45zD2PMzS1jDTTXWtcJtYwmj6pWvKceXZYfxa1AZkOc0McRA2M3zmvak8fk3GgFS2i6bVzGbujBZc0XWktIDKeVCejQ8rIzEvwc+ARJgjb5x7J6MPTEsO+7bKhl7JjFhi5648kuMFncY0IEMjeGzL4wtOOgqjLFT9h1XcvMSfxKHMuMohJUCcdtXkoixZgYEaYPBvnRdUVZeETjcGIIFrKelUBhpNGMIo2RihiJyPnN2B3LZLCWhXW4MGZvfcRlXHAdZ1yYoMl5zEyKQOYLXZ84v9Kg/sqgbFhKoKGrc+jwzoq4MJZXZljwg+sXJmxhUmbem+rMvL+P3Z3bh32jIcPQRjRkqKlHzbVvexiyKRmGihVSUTbfiz22n5K5xXKvlGqL4+AdJiZoHGaMLMM4jFTAgNBI9nOW+2HY6lndxF09MUyQ8ikpYMpo6HP59R4hQYTfwHopO0tRG1ZQFrdUzZPBivS9kTjyAsUrpXdfBTdQ0HvN30P96XLKNKl7TfnQHcd6zqF4FO2/IPcP0s9SE5BSSz1OPzP7H6i7biPdRJrAwP4XxxE+uNwArLSnHCfpNHbbk/V+vo9qy3qqZcnUt+MRR1aAoBBZbJAyq3i+jwlfubwbFKordfdK/S3U3UxMxImZfut7rHxwLI6Y+NBAeD7i+GP9N5dLWr6yg7zHHj/XBR8vZ3ycT/h1OeP1fMZCHfYSDupzoQ6vLL1X/jiIB/dltzH8DT5GiN5AMxY+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"super2\"\n        title=\"super2\"\n        src=\"/static/0a511831ff39e850b7c5d06a6d0c9bd9/fcda8/super2.png\"\n        srcset=\"/static/0a511831ff39e850b7c5d06a6d0c9bd9/12f09/super2.png 148w,\n/static/0a511831ff39e850b7c5d06a6d0c9bd9/e4a3f/super2.png 295w,\n/static/0a511831ff39e850b7c5d06a6d0c9bd9/fcda8/super2.png 590w,\n/static/0a511831ff39e850b7c5d06a6d0c9bd9/33e10/super2.png 844w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n다음의 두 메소드이다. 하지만 나는 앞서 말했듯이 이걸사용해서 직접구현하지 않고 DaoAuthenticationProvider를 사용 할 것이다.</p>\n<blockquote>\n<p>아 그리고 이건 지금 작성하면서 안 사실인데 additionalAuthenticationChecks가 deprecated될 상황이란것이다.\n하지만 간단하게 할거니까 무시하자..\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ccde9e007473917925c494157833d964/940c5/deprecated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLUlEQVQ4y32T2XraMBCFeZxgvGmzTUiAhJIYiBdsYwjwtX3/lzg9Eku56NeL32dGlo7G8mgwmwSYZCO8jAOMM4ksE8hSCSMjEkJRhZSOWAhIpSClQhgGCIK/hGHoGKgowPRlgsX7DMvFnMyweHvF+/yVOsUbdf6+wHQ2x+RliiRNkSQpRBwjviJE7Ew9z8NAMmn7A/rDEd3+jMPpN/aOX9gfLT8du8MZm7LBj88NfuQFlqsSH+vSxeuyRTZ+xtPTEwZxFKGoGnzVHT7LPfL6hNX2hLw6MP5GXvbU43XsG6uqx7reY01dXSnaI7LnycUwDGlYt9juTmj6M+rdGVX3jdpxJAfmNCxarMqOm9eo6i1KalFWTr+Kkmc/vhhGrLDetuh2PZpuh7brXNxe86a1dHfa3d7Nr0jT9dgUFVYbGo6vhlJpVJy45UKLnVTVDermMmYX2thyi61Jvv7CR77C8iPH8jOHNgmGwyEGQkiXGJKkmUNxE8M/aWOnN5hrbRhz3BjY87dH5vMPj0ajy1+O2U9GjpHoMYxK2WfcIDVQRkMnBiZNoBLFPhQul1pxLIXJUo5rRHF0N7M68PlIRYRECU7M7kZKaxdLodjchBXpJGFzx6xohCD0qT77j/poaB+hP4Rgg6cZP4XV6VTfMaxCsSqppasoljHCmDcjDp0+Vuc+2fd9DO0AVfBq2RsQ0txWEET+JWYVnje8MLosfsTzrD5UeHP/H4+L//Xupn8AQdi4ZiobyoUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"deprecated\"\n        title=\"deprecated\"\n        src=\"/static/ccde9e007473917925c494157833d964/fcda8/deprecated.png\"\n        srcset=\"/static/ccde9e007473917925c494157833d964/12f09/deprecated.png 148w,\n/static/ccde9e007473917925c494157833d964/e4a3f/deprecated.png 295w,\n/static/ccde9e007473917925c494157833d964/fcda8/deprecated.png 590w,\n/static/ccde9e007473917925c494157833d964/940c5/deprecated.png 772w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span> </p>\n</blockquote>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">    @Bean\n    public AuthenticationProvider authenticationProvider() {\n        DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider();\n        daoAuthenticationProvider.setPasswordEncoder(passwordEncoder());\n        daoAuthenticationProvider.setUserDetailsService(customUserDetailsService);\n        return daoAuthenticationProvider;\n    }</code>\n        </deckgo-highlight-code>\n<p>다음과 같이 security 안에 Bean 등록을 해주고 </p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception {\n        auth.authenticationProvider(authenticationProvider());\n    }</code>\n        </deckgo-highlight-code>\n<p>빌더를 통해 provider를 넣어주자! 끗</p>\n<h2 id=\"userdetails\" style=\"position:relative;\"><a href=\"#userdetails\" aria-label=\"userdetails permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"#userdetails\" aria-label=\"userdetails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetails</h2>\n<p>Provider는 적당히 있는 DAOauthenticationprovider를 사용했지만 나름 뭔가 커스텀한 느낌을 주기위해 UserDetailsService를 구현한\nCustomUserDetailsService를 작성해보자.</p>\n<p>일단 현재 사용하는 Provider의 authenticate메소드를 보자.\nAbstractUserDetailsAuthenticationProvider는 현재 authenticate 메소드 안에서 retrieveUser를 호출하고\n이 retrieveUser는 하위 클래스 DaoAuthenticationProvider에서 정의 되어있고<br>\nretrieveUser 안에서 UserDetails 인터페이스의 loadByUserName을 호출하게 되는 것이다.</p>\n<p>사실 내가 작성해도 무슨말인지 잘모르겠다. 일단 UserDetails인터페이스를 구현한 CustomUserDetailsService를 만들자</p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">@RequiredArgsConstructor\n@Service\npublic class CustomUserDetailsService implements UserDetailsService {\n\n    private final UserRepository userRepository;\n\n    @Override\n    @Transactional\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        User user = userRepository.findByEmail(username);\n        if(user == null){\n            throw new AuthenticationCredentialsNotFoundException(&quot;User not found with username or email : &quot; + username);\n        }\n        return UserPrincipal.create(user);\n    }\n\n}</code>\n        </deckgo-highlight-code>\n<p>loadUserByUsername 메소드의 역할은 username(email)을 받아서 UserDetails 인터페이스를 구현한 어떤것을 반환하면 됀다.\n그럼 구현해야 할것들이</p>\n<ol>\n<li>User 엔티티</li>\n<li>UserRepository</li>\n<li>UserDetails 인터페이스의 구현체 -> UserPrincipal 이라고 이름지을거임 ㅎ</li>\n</ol>\n<h3 id=\"user-entity\" style=\"position:relative;\"><a href=\"#user-entity\" aria-label=\"user entity permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"#user-entity\" aria-label=\"user entity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>User Entity</h3>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">// UserEntity\n\n@Getter\n@NoArgsConstructor\n@Table(name =&quot;TB_USER&quot;)\n@Entity\npublic class User {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name=&quot;USER_ID&quot;)\n    private Long id;\n\n    @NotBlank\n    @Column(nullable = false)\n    private String email;\n\n    @NotBlank\n    @Column(nullable = false)\n    private String username;\n\n    @NotBlank\n    @Column(nullable = false)\n    private String password;\n\n    @Builder\n    public User(String email, String password, String username) {\n        this.email = email;\n        this.password = password;\n        this.username = username;\n    }\n\n    @ManyToMany(fetch = FetchType.LAZY)\n    @JoinTable(name = &quot;USER_ROLE&quot;,\n            joinColumns = @JoinColumn(name = &quot;user_id&quot;),\n            inverseJoinColumns = @JoinColumn(name = &quot;role_id&quot;))\n    private Set&lt;Role&gt; roles = new HashSet&lt;&gt;();\n\n    public void setRoles(Set&lt;Role&gt; roles) {\n        this.roles = roles;\n    }\n}\n \n// UserRepository\n\npublic interface UserRepository extends JpaRepository&lt;User,Long&gt; {\n    User findByEmail(String email);\n}\n\n// Role Entity\n\n@NoArgsConstructor\n@Table(name=&quot;ROLE&quot;)\n@Getter\n@Entity\npublic class Role {\n    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name=&quot;ROLE_ID&quot;)\n    private Long id;\n\n    @Enumerated(EnumType.STRING)\n    @Column\n    private RoleName name;\n\n    @Builder\n    public Role(RoleName name) {\n        this.name = name;\n    }\n}\n\n\n// Role Repository\n\npublic interface RoleRepository extends JpaRepository&lt;Role, Long&gt; {\n}</code>\n        </deckgo-highlight-code>\n<h3 id=\"userprincipal\" style=\"position:relative;\"><a href=\"#userprincipal\" aria-label=\"userprincipal permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"#userprincipal\" aria-label=\"userprincipal permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserPrincipal</h3>\n<p>그리고 UserPrincipal 클래스. 이 클래스는 ValueObject 즉 값을 저장하고 쓰는 공간이라고 생각하면 쉽다.</p>\n<deckgo-highlight-code language=\"java\"  terminal=\"carbon\" >\n          <code slot=\"code\">@Getter\npublic class UserPrincipal implements UserDetails {\n\n    private Long id;\n\n    private String username;\n\n    @JsonIgnore\n    private String email;\n\n    @JsonIgnore\n    private String password;\n\n    private Collection&lt;? extends GrantedAuthority&gt; authorities;\n\n    public UserPrincipal(Long id, String username, String email, String password, Collection&lt;? extends GrantedAuthority&gt; authorities) {\n        this.id = id;\n        this.username = username;\n        this.email = email;\n        this.password = password;\n        this.authorities = authorities;\n    }\n\n    public static UserPrincipal create(User user) {\n        List&lt;GrantedAuthority&gt; authorities = user.getRoles().stream().map(role -&gt;\n                new SimpleGrantedAuthority(role.getName().name())\n        ).collect(Collectors.toList());\n\n        return new UserPrincipal(\n                user.getId(),\n                user.getUsername(),\n                user.getEmail(),\n                user.getPassword(),\n                authorities\n        );\n    }\n\n\n    @Override\n    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {\n        return authorities;\n    }\n\n    @Override\n    public String getPassword() {\n        return password;\n    }\n\n    @Override\n    public String getUsername() {\n        return username;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash(id);\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n        UserPrincipal that = (UserPrincipal) o;\n        return Objects.equals(id, that.id);\n    }\n}</code>\n        </deckgo-highlight-code>\n<p>여기까지 만들고 auto import 켜둔 상태라면 CustomUserDetailsService에 빨간줄이 사라져있을 것이다.\n이제 남은거는</p>\n<ol>\n<li><del>Provider 구현체 DaoAuthenticationProvider</del></li>\n<li><del>UserDetailsService 구현체 CustomUserDetailsService</del></li>\n<li><del>User Entity 및 UserPrincipal</del></li>\n<li>header인증을 위한 BasicAuthenticationFilter 구현체 JwtAuthorizationFilter</li>\n<li>AuthenticationEntryPoint 구현체 CustomAuthenticationEntryPoint</li>\n<li>ErrorResponseDTO</li>\n</ol>\n<p>나머지 3개는 다음포스팅때~</p>","excerpt":"저번 포스트에서 귀찮아서 작성하지 못했던 security 관련 설정파일들을 작성해보자. Provider 구현체 DaoAuthenticationProvider UserDetailsService 구현체 CustomUserDetailsService User…","tableOfContents":"<ul>\n<li><a href=\"/springboot-react-trello_3/#provider\">Provider</a></li>\n<li>\n<p><a href=\"/springboot-react-trello_3/#userdetails\">UserDetails</a></p>\n<ul>\n<li><a href=\"/springboot-react-trello_3/#user-entity\">User Entity</a></li>\n<li><a href=\"/springboot-react-trello_3/#userprincipal\">UserPrincipal</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/springboot-react-trello_3/"},"frontmatter":{"title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 3 )","date":"May 26, 2020","tags":["springboot","react"],"keywords":["trello","springboot","react"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/springboot-react-trello_3/","series":[{"slug":"/springboot-react-trello_1/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 1 )","num":1},{"slug":"/springboot-react-trello_2/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 2 )","num":2},{"slug":"/springboot-react-trello_3/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 3 )","num":3},{"slug":"/springboot-react-trello_4/","title":"Spring Boot, React 사용해 Trello 클론코딩하기 ( 4 )","num":4}],"lastmod":"0001-01-01"}},"staticQueryHashes":["3649515864","63159454"]}